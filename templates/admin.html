{% extends "base.html" %}

{% block title %}Portfolio Builder - Solarpunk Portfolio{% endblock %}

{% block content %}
<div class="admin-page">
    <div class="builder-header">
        <h1>Build Your Portfolio</h1>
        <div class="header-actions">
            <button id="saveBtn" class="btn btn-secondary">Save</button>
            <button id="previewBtn" class="btn btn-secondary">Preview</button>
            <button id="deployBtn" class="btn btn-primary">Deploy to GitHub Pages</button>
        </div>
    </div>

    <div class="builder-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
                <h3>Layout Style</h3>
                <div class="layout-options">
                    <button class="layout-btn {% if data.layout == 'classic' %}active{% endif %}" data-layout="classic" title="Classic - Clean centered layout">
                        <svg viewBox="0 0 40 30" width="40" height="30"><rect x="10" y="2" width="20" height="4" fill="currentColor"/><rect x="8" y="8" width="24" height="8" fill="currentColor" opacity="0.5"/><rect x="12" y="18" width="16" height="3" fill="currentColor" opacity="0.3"/><rect x="12" y="23" width="16" height="3" fill="currentColor" opacity="0.3"/></svg>
                        <span>Classic</span>
                    </button>
                    <button class="layout-btn {% if data.layout == 'bento' %}active{% endif %}" data-layout="bento" title="Bento - Asymmetric grid layout">
                        <svg viewBox="0 0 40 30" width="40" height="30"><rect x="2" y="2" width="16" height="12" fill="currentColor"/><rect x="20" y="2" width="18" height="6" fill="currentColor" opacity="0.5"/><rect x="20" y="10" width="8" height="8" fill="currentColor" opacity="0.3"/><rect x="30" y="10" width="8" height="8" fill="currentColor" opacity="0.5"/><rect x="2" y="16" width="10" height="12" fill="currentColor" opacity="0.3"/><rect x="14" y="16" width="24" height="12" fill="currentColor" opacity="0.5"/></svg>
                        <span>Bento</span>
                    </button>
                    <button class="layout-btn {% if data.layout == 'bold' %}active{% endif %}" data-layout="bold" title="Bold - Editorial style with big type">
                        <svg viewBox="0 0 40 30" width="40" height="30"><rect x="2" y="2" width="36" height="10" fill="currentColor"/><rect x="2" y="14" width="18" height="14" fill="currentColor" opacity="0.3" transform="skewY(-2)"/><rect x="22" y="14" width="16" height="6" fill="currentColor" opacity="0.5"/><rect x="22" y="22" width="16" height="6" fill="currentColor" opacity="0.5"/></svg>
                        <span>Bold</span>
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>Color Scheme</h3>
                <div class="color-schemes">
                    {% for key, scheme in schemes.items() %}
                    <button class="scheme-btn {% if data.color_scheme == key %}active{% endif %}"
                            data-scheme="{{ key }}"
                            style="background: linear-gradient(135deg, {{ scheme.primary }} 50%, {{ scheme.secondary }} 50%);"
                            title="{{ scheme.name }}">
                    </button>
                    {% endfor %}
                </div>
                <p class="selected-scheme">Selected: <span id="schemeName">{{ schemes[data.color_scheme].name }}</span></p>
            </div>

            <div class="sidebar-section">
                <h3>Section Order</h3>
                <p class="help-text">Drag to reorder sections</p>
                <ul id="sectionOrder" class="sortable-list">
                    {% for section in data.section_order %}
                    <li data-section="{{ section }}" draggable="true">
                        <span class="drag-handle">&#9776;</span>
                        {{ section|title }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </aside>

        <div class="main-editor">
            <form id="portfolioForm">
                <section class="editor-section" id="edit-bio">
                    <h2>Bio</h2>
                    <div class="form-group">
                        <label for="bioName">Full Name</label>
                        <input type="text" id="bioName" name="bio.name" value="{{ data.bio.name }}" required>
                    </div>
                    <div class="form-group">
                        <label for="bioTitle">Professional Title</label>
                        <input type="text" id="bioTitle" name="bio.title" value="{{ data.bio.title }}" placeholder="e.g., Software Engineer, UX Designer">
                    </div>
                    <div class="form-group">
                        <label for="bioSummary">Summary</label>
                        <textarea id="bioSummary" name="bio.summary" rows="4" placeholder="A brief professional summary...">{{ data.bio.summary }}</textarea>
                    </div>
                </section>

                <section class="editor-section" id="edit-photo">
                    <h2>Photo</h2>
                    <div class="form-group">
                        <label for="photoUrl">Photo URL</label>
                        <input type="url" id="photoUrl" name="photo.url" value="{{ data.photo.url }}" placeholder="https://example.com/your-photo.jpg">
                        <p class="help-text">Use a professional headshot. Tip: Upload to LinkedIn or Gravatar and copy the image URL.</p>
                    </div>
                    <div class="photo-preview">
                        <img id="photoPreview" src="{{ data.photo.url }}" alt="Photo preview" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
                    </div>
                </section>

                <section class="editor-section" id="edit-banner">
                    <h2>Banner Image <span class="optional-tag">Optional</span></h2>
                    <div class="form-group">
                        <label for="bannerUrl">Banner URL</label>
                        <input type="url" id="bannerUrl" name="banner.url" value="{{ data.banner.url if data.banner else '' }}" placeholder="https://example.com/your-banner.jpg">
                        <p class="help-text">A wide image (recommended: 1200x400px) shown at the top of your portfolio. Works great with Bento and Bold layouts.</p>
                    </div>
                    <div class="banner-preview">
                        <img id="bannerPreview" src="{{ data.banner.url if data.banner and data.banner.url else 'https://via.placeholder.com/600x200?text=No+Banner' }}" alt="Banner preview" onerror="this.src='https://via.placeholder.com/600x200?text=Invalid+URL'">
                    </div>
                </section>

                <section class="editor-section" id="edit-skills">
                    <h2>Skills</h2>
                    <div class="form-group">
                        <label>Your Skills</label>
                        <div id="skillsList" class="tags-input">
                            {% for skill in data.skills %}
                            <div class="tag">
                                <span>{{ skill }}</span>
                                <button type="button" class="tag-remove">&times;</button>
                            </div>
                            {% endfor %}
                            <input type="text" id="skillInput" placeholder="Type a skill and press Enter">
                        </div>
                    </div>
                </section>

                <section class="editor-section" id="edit-projects">
                    <h2>Projects</h2>
                    <div id="projectsList">
                        {% for project in data.projects %}
                        <div class="project-item">
                            <div class="form-group">
                                <label>Project Title</label>
                                <input type="text" name="project_title" value="{{ project.title }}">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="project_desc" rows="2">{{ project.description }}</textarea>
                            </div>
                            <div class="form-group">
                                <label>Link (optional)</label>
                                <input type="url" name="project_link" value="{{ project.link }}" placeholder="https://">
                            </div>
                            <button type="button" class="btn btn-danger btn-small remove-project">Remove</button>
                        </div>
                        {% endfor %}
                    </div>
                    <button type="button" id="addProject" class="btn btn-secondary">+ Add Project</button>
                </section>

                <section class="editor-section" id="edit-contact">
                    <h2>Contact</h2>
                    <div class="form-group">
                        <label for="contactEmail">Email</label>
                        <input type="email" id="contactEmail" name="contact.email" value="{{ data.contact.email }}" required>
                    </div>
                    <div class="form-group">
                        <label for="contactPhone">Phone (optional)</label>
                        <input type="tel" id="contactPhone" name="contact.phone" value="{{ data.contact.phone }}">
                    </div>
                    <div class="form-group">
                        <label for="contactLocation">Location</label>
                        <input type="text" id="contactLocation" name="contact.location" value="{{ data.contact.location }}" placeholder="City, State">
                    </div>
                </section>

                <section class="editor-section" id="edit-social">
                    <h2>Social Links</h2>
                    <div class="form-group">
                        <label for="socialLinkedIn">
                            <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg>
                            LinkedIn
                        </label>
                        <input type="url" id="socialLinkedIn" name="social.linkedin" value="{{ data.social.linkedin }}" placeholder="https://linkedin.com/in/yourprofile">
                    </div>
                    <div class="form-group">
                        <label for="socialGitHub">
                            <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg>
                            GitHub
                        </label>
                        <input type="url" id="socialGitHub" name="social.github" value="{{ data.social.github }}" placeholder="https://github.com/yourusername">
                    </div>
                    <div class="form-group">
                        <label for="socialInstagram">
                            <svg class="social-icon" viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4a5.8 5.8 0 0 1-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8A5.8 5.8 0 0 1 7.8 2m-.2 2A3.6 3.6 0 0 0 4 7.6v8.8C4 18.39 5.61 20 7.6 20h8.8a3.6 3.6 0 0 0 3.6-3.6V7.6C20 5.61 18.39 4 16.4 4H7.6m9.65 1.5a1.25 1.25 0 0 1 1.25 1.25A1.25 1.25 0 0 1 17.25 8 1.25 1.25 0 0 1 16 6.75a1.25 1.25 0 0 1 1.25-1.25M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg>
                            Instagram
                        </label>
                        <input type="url" id="socialInstagram" name="social.instagram" value="{{ data.social.instagram }}" placeholder="https://instagram.com/yourusername">
                    </div>
                </section>
            </form>
        </div>
    </div>
</div>

<!-- Deploy Modal -->
<div id="deployModal" class="modal">
    <div class="modal-content">
        <h2>Deploying to GitHub Pages</h2>
        <div id="deploySteps" class="deploy-steps"></div>
        <div id="deployResult" class="deploy-result"></div>
        <button id="closeModal" class="btn btn-secondary" style="display:none;">Close</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/builder.js') }}"></script>
{% endblock %}
